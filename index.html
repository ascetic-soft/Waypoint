<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waypoint ‚Äî Lightweight PSR-15 PHP Router</title>
    <meta name="description" content="A lightweight PSR-15 compatible PHP router with attribute-based routing, prefix-trie matching, middleware pipeline, route caching, and built-in diagnostics.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <link rel="stylesheet" href="assets/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìç</text></svg>">
</head>
<body>

<!-- ============ SIDEBAR NAV ============ -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <a href="#" class="logo">
            <span class="logo-icon">W</span>
            <span class="logo-text">Waypoint</span>
        </a>
        <button class="sidebar-close" id="sidebar-close" aria-label="Close menu">&times;</button>
    </div>
    <nav class="sidebar-nav">
        <ul>
            <li class="nav-section-title">Getting Started</li>
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#installation">Installation</a></li>
            <li><a href="#quick-start">Quick Start</a></li>

            <li class="nav-section-title">Core Concepts</li>
            <li><a href="#route-registration">Route Registration</a></li>
            <li><a href="#route-parameters">Route Parameters</a></li>
            <li><a href="#attribute-routing">Attribute Routing</a></li>
            <li><a href="#route-groups">Route Groups</a></li>
            <li><a href="#middleware">Middleware</a></li>

            <li class="nav-section-title">Advanced</li>
            <li><a href="#dependency-injection">Dependency Injection</a></li>
            <li><a href="#url-generation">URL Generation</a></li>
            <li><a href="#route-caching">Route Caching</a></li>
            <li><a href="#diagnostics">Diagnostics</a></li>
            <li><a href="#exception-handling">Exception Handling</a></li>

            <li class="nav-section-title">Reference</li>
            <li><a href="#architecture">Architecture</a></li>
            <li><a href="#api-reference">API Reference</a></li>
            <li><a href="#development">Development</a></li>
        </ul>
    </nav>
    <div class="sidebar-footer">
        <a href="ru.html" class="lang-switch" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–∏–π">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg>
            <span>–†—É—Å—Å–∫–∏–π</span>
        </a>
        <a href="https://github.com/ascetic-soft/Waypoint" class="github-link" target="_blank" rel="noopener">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            <span>GitHub</span>
        </a>
        <a href="https://packagist.org/packages/ascetic-soft/waypoint" class="packagist-link" target="_blank" rel="noopener">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M0 1.398v21.204h24V1.398H0zm16.473 6.837l-3.446 1.283-.375.14-.373-.14L8.83 8.235 5.293 9.548l1.313.489 2.224.83 3.445 1.283.375.14.373-.14 3.447-1.283 2.224-.83 1.313-.489-3.534-1.313zm-4.194 4.252L8.85 11.2l-3.445-1.283-1.84-.685v7.623l8.714 3.245V12.487zm.748 0v8.613l8.714-3.245v-7.623l-1.84.685-3.445 1.283-3.429 1.287z"/></svg>
            <span>Packagist</span>
        </a>
    </div>
</aside>

<!-- ============ MAIN CONTENT ============ -->
<main class="main">
    <!-- Mobile Header -->
    <header class="mobile-header">
        <button class="hamburger" id="hamburger" aria-label="Open menu">
            <span></span><span></span><span></span>
        </button>
        <a href="#" class="mobile-logo">
            <span class="logo-icon">W</span>
            <span>Waypoint</span>
        </a>
    </header>

    <div class="content">
        <!-- ============ HERO ============ -->
        <section class="hero" id="introduction">
            <div class="hero-badges">
                <a href="https://github.com/ascetic-soft/Waypoint/actions/workflows/ci.yml" target="_blank" rel="noopener"><img src="https://github.com/ascetic-soft/Waypoint/actions/workflows/ci.yml/badge.svg" alt="CI"></a>
                <a href="https://codecov.io/gh/ascetic-soft/Waypoint" target="_blank" rel="noopener"><img src="https://codecov.io/gh/ascetic-soft/Waypoint/graph/badge.svg" alt="codecov"></a>
                <img src="https://img.shields.io/badge/phpstan-level%209-brightgreen" alt="PHPStan Level 9">
                <a href="https://packagist.org/packages/ascetic-soft/waypoint" target="_blank" rel="noopener"><img src="https://img.shields.io/packagist/v/ascetic-soft/waypoint" alt="Latest Version"></a>
                <img src="https://img.shields.io/packagist/dependency-v/ascetic-soft/waypoint/php" alt="PHP Version">
                <a href="https://packagist.org/packages/ascetic-soft/waypoint" target="_blank" rel="noopener"><img src="https://img.shields.io/packagist/l/ascetic-soft/waypoint" alt="License"></a>
            </div>
            <h1>Waypoint</h1>
            <p class="hero-subtitle">A lightweight, blazing-fast PSR-15 PHP router with attribute-based routing, prefix-trie matching, middleware pipeline, route caching, and built-in diagnostics.</p>
            <div class="hero-install">
                <code>composer require ascetic-soft/waypoint</code>
                <button class="copy-btn" data-copy="composer require ascetic-soft/waypoint" aria-label="Copy to clipboard">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                </button>
            </div>
        </section>

        <!-- ============ FEATURES ============ -->
        <section class="features">
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    </div>
                    <h3>PSR-15 Compliant</h3>
                    <p>Implements <code>RequestHandlerInterface</code>. Works seamlessly with any PSR-7 / PSR-15 stack.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                    </div>
                    <h3>Prefix-Trie Matching</h3>
                    <p>Static segments resolved via O(1) hash-map lookups. Dynamic segments tested only when necessary.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>
                    </div>
                    <h3>Attribute Routing</h3>
                    <p>Declare routes with PHP 8 <code>#[Route]</code> attributes directly on controller classes and methods.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
                    </div>
                    <h3>Middleware Pipeline</h3>
                    <p>Global and per-route PSR-15 middleware with FIFO execution order.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/></svg>
                    </div>
                    <h3>Route Caching</h3>
                    <p>Compile routes to a PHP file for OPcache-friendly, zero-overhead production loading.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                    </div>
                    <h3>Diagnostics</h3>
                    <p>Detect duplicate paths, duplicate names, and shadowed routes with built-in diagnostic tools.</p>
                </div>
            </div>
        </section>

        <!-- ============ REQUIREMENTS ============ -->
        <section class="doc-section" id="installation">
            <h2>Installation</h2>
            <div class="requirements-box">
                <h3>Requirements</h3>
                <ul>
                    <li>PHP &ge; 8.4</li>
                    <li><code>ext-mbstring</code></li>
                </ul>
            </div>
            <p>Install Waypoint via Composer:</p>
            <pre><code class="language-bash">composer require ascetic-soft/waypoint</code></pre>
        </section>

        <!-- ============ QUICK START ============ -->
        <section class="doc-section" id="quick-start">
            <h2>Quick Start</h2>
            <p>Get up and running in seconds. Create a router, register a route, and handle a request:</p>
            <pre><code class="language-php">use AsceticSoft\Waypoint\Router;
use Nyholm\Psr7\ServerRequest;

$router = new Router($container); // any PSR-11 container

$router->get('/hello/{name}', function (string $name) use ($responseFactory) {
    $response = $responseFactory->createResponse();
    $response->getBody()->write("Hello, {$name}!");
    return $response;
});

$request  = new ServerRequest('GET', '/hello/world');
$response = $router->handle($request);</code></pre>
        </section>

        <!-- ============ ROUTE REGISTRATION ============ -->
        <section class="doc-section" id="route-registration">
            <h2>Route Registration</h2>
            <p>Register routes with the fluent API. Shortcut methods are provided for common HTTP verbs:</p>
            <pre><code class="language-php">// Full form
$router->addRoute('/users', [UserController::class, 'list'], methods: ['GET']);

// Shortcuts
$router->get('/users',          [UserController::class, 'list']);
$router->post('/users',         [UserController::class, 'create']);
$router->put('/users/{id}',     [UserController::class, 'update']);
$router->delete('/users/{id}',  [UserController::class, 'destroy']);</code></pre>

            <h3>Method Parameters</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><code>$path</code></td><td><code>string</code></td><td>&mdash;</td><td>Route pattern (e.g. <code>/users/{id}</code>)</td></tr>
                        <tr><td><code>$handler</code></td><td><code>array|Closure</code></td><td>&mdash;</td><td><code>[Class::class, 'method']</code> or a closure</td></tr>
                        <tr><td><code>$middleware</code></td><td><code>string[]</code></td><td><code>[]</code></td><td>Route-specific middleware class names</td></tr>
                        <tr><td><code>$name</code></td><td><code>string</code></td><td><code>''</code></td><td>Optional route name</td></tr>
                        <tr><td><code>$priority</code></td><td><code>int</code></td><td><code>0</code></td><td>Matching priority (higher = first)</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ============ ROUTE PARAMETERS ============ -->
        <section class="doc-section" id="route-parameters">
            <h2>Route Parameters</h2>
            <p>Parameters use FastRoute-style placeholders. They are automatically injected into handlers by name, with type coercion for scalar types.</p>
            <pre><code class="language-php">// Basic parameter ‚Äî matches any non-slash segment
$router->get('/users/{id}', [UserController::class, 'show']);

// Constrained parameter ‚Äî only digits
$router->get('/users/{id:\d+}', [UserController::class, 'show']);

// Multiple parameters
$router->get('/posts/{year:\d{4}}/{slug}', [PostController::class, 'show']);</code></pre>
            <div class="callout callout-info">
                <strong>Automatic Type Coercion</strong>
                <p>Route parameters are automatically cast to the type declared in the handler signature. For example, <code>int $id</code> will receive an integer value, not a string.</p>
            </div>
            <pre><code class="language-php">$router->get('/users/{id:\d+}', function (int $id) {
    // $id is automatically cast to int
});</code></pre>
        </section>

        <!-- ============ ATTRIBUTE ROUTING ============ -->
        <section class="doc-section" id="attribute-routing">
            <h2>Attribute-Based Routing</h2>
            <p>Declare routes directly on controller classes using the <code>#[Route]</code> attribute. The class-level attribute sets a path prefix and shared middleware; method-level attributes define concrete routes.</p>
            <pre><code class="language-php">use AsceticSoft\Waypoint\Attribute\Route;

#[Route('/api/users', middleware: [AuthMiddleware::class])]
class UserController
{
    #[Route('/', methods: ['GET'], name: 'users.list')]
    public function list(): ResponseInterface { /* ... */ }

    #[Route('/{id:\d+}', methods: ['GET'], name: 'users.show')]
    public function show(int $id): ResponseInterface { /* ... */ }

    #[Route('/', methods: ['POST'], name: 'users.create')]
    public function create(ServerRequestInterface $request): ResponseInterface { /* ... */ }

    #[Route('/{id:\d+}', methods: ['PUT'], name: 'users.update')]
    public function update(int $id, ServerRequestInterface $request): ResponseInterface { /* ... */ }

    #[Route('/{id:\d+}', methods: ['DELETE'], name: 'users.delete')]
    public function delete(int $id): ResponseInterface { /* ... */ }
}</code></pre>
            <p>The attribute is <strong>repeatable</strong>, so a single method can handle multiple routes.</p>

            <h3>Loading Attributes</h3>
            <pre><code class="language-php">// Load specific controller classes
$router->loadAttributes(
    UserController::class,
    PostController::class,
);

// Or scan an entire directory
$router->scanDirectory(__DIR__ . '/Controllers', 'App\\Controllers');</code></pre>

            <h3>Attribute Parameters</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><code>$path</code></td><td><code>string</code></td><td><code>''</code></td><td>Path pattern (prefix on class, route on method)</td></tr>
                        <tr><td><code>$methods</code></td><td><code>string[]</code></td><td><code>['GET']</code></td><td>HTTP methods (ignored on class-level)</td></tr>
                        <tr><td><code>$name</code></td><td><code>string</code></td><td><code>''</code></td><td>Route name</td></tr>
                        <tr><td><code>$middleware</code></td><td><code>string[]</code></td><td><code>[]</code></td><td>Middleware (class-level prepended to method-level)</td></tr>
                        <tr><td><code>$priority</code></td><td><code>int</code></td><td><code>0</code></td><td>Matching priority (higher = first)</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ============ ROUTE GROUPS ============ -->
        <section class="doc-section" id="route-groups">
            <h2>Route Groups</h2>
            <p>Group related routes under a shared prefix and middleware. Groups can be nested &mdash; prefixes and middleware accumulate from outer to inner groups.</p>
            <pre><code class="language-php">$router->group('/api', function (Router $router) {

    $router->group('/v1', function (Router $router) {
        $router->get('/users', [UserController::class, 'list']);
        // Matches: /api/v1/users
    });

    $router->group('/v2', function (Router $router) {
        $router->get('/users', [UserV2Controller::class, 'list']);
        // Matches: /api/v2/users
    });

}, middleware: [ApiAuthMiddleware::class]);</code></pre>
        </section>

        <!-- ============ MIDDLEWARE ============ -->
        <section class="doc-section" id="middleware">
            <h2>Middleware</h2>
            <p>Waypoint supports PSR-15 middleware at two levels:</p>

            <h3>Global Middleware</h3>
            <p>Runs for every matched route:</p>
            <pre><code class="language-php">$router->addMiddleware(CorsMiddleware::class);
$router->addMiddleware(new RateLimitMiddleware(limit: 100));</code></pre>

            <h3>Route-Level Middleware</h3>
            <p>Applied to specific routes:</p>
            <pre><code class="language-php">$router->get('/admin/dashboard', [AdminController::class, 'dashboard'],
    middleware: [AdminAuthMiddleware::class],
);</code></pre>

            <div class="callout callout-tip">
                <strong>Execution Order</strong>
                <p>Middleware is resolved from the PSR-11 container when provided as a class name string, or used directly when provided as an instance. Execution order is FIFO: global middleware first, then route-specific middleware, then the controller handler.</p>
            </div>
        </section>

        <!-- ============ DEPENDENCY INJECTION ============ -->
        <section class="doc-section" id="dependency-injection">
            <h2>Dependency Injection</h2>
            <p>The <code>RouteHandler</code> automatically resolves controller method parameters in the following order:</p>
            <ol class="di-order">
                <li><code>ServerRequestInterface</code> &mdash; the current PSR-7 request</li>
                <li><strong>Route parameters</strong> &mdash; matched by name, with type coercion (<code>int</code>, <code>float</code>, <code>bool</code>)</li>
                <li><strong>Container services</strong> &mdash; resolved from the PSR-11 container by type-hint</li>
                <li><strong>Default values</strong> &mdash; used if available</li>
                <li><strong>Nullable parameters</strong> &mdash; receive <code>null</code></li>
            </ol>
            <pre><code class="language-php">#[Route('/orders/{id:\d+}', methods: ['GET'])]
public function show(
    int $id,                          // route parameter (auto-cast)
    ServerRequestInterface $request,  // current request
    OrderRepository $repo,            // resolved from container
    ?LoggerInterface $logger = null,  // container or default
): ResponseInterface {
    // ...
}</code></pre>
        </section>

        <!-- ============ URL GENERATION ============ -->
        <section class="doc-section" id="url-generation">
            <h2>URL Generation</h2>
            <p>Generate URLs from named routes (reverse routing). Assign names when registering routes, then use <code>generate()</code> to build paths:</p>
            <pre><code class="language-php">// Register named routes
$router->get('/users',          [UserController::class, 'list'], name: 'users.list');
$router->get('/users/{id:\d+}', [UserController::class, 'show'], name: 'users.show');

// Generate URLs
$url = $router->generate('users.show', ['id' => 42]);
// => /users/42

$url = $router->generate('users.list', query: ['page' => 2, 'limit' => 10]);
// => /users?page=2&limit=10</code></pre>
            <p>Parameters are automatically URL-encoded. Extra parameters not present in the route pattern are ignored. Missing required parameters throw <code>MissingParametersException</code>.</p>

            <h3>Using UrlGenerator Directly</h3>
            <pre><code class="language-php">use AsceticSoft\Waypoint\UrlGenerator;

$generator = new UrlGenerator($router->getRouteCollection());
$url = $generator->generate('users.show', ['id' => 42]);</code></pre>
        </section>

        <!-- ============ ROUTE CACHING ============ -->
        <section class="doc-section" id="route-caching">
            <h2>Route Caching</h2>
            <p>Compile routes to a PHP file for zero-overhead loading in production. The cache file is a plain PHP array that loads instantly through OPcache, bypassing all Reflection and attribute parsing.</p>

            <h3>Compiling the Cache</h3>
            <pre><code class="language-php">// During deployment / cache warm-up
$router->compileTo(__DIR__ . '/cache/routes.php');</code></pre>

            <h3>Loading from Cache</h3>
            <pre><code class="language-php">$cacheFile = __DIR__ . '/cache/routes.php';

$router = new Router($container);

if (file_exists($cacheFile)) {
    $router->loadCache($cacheFile);
} else {
    $router->scanDirectory(__DIR__ . '/Controllers', 'App\\Controllers');
    $router->compileTo($cacheFile);
}</code></pre>
        </section>

        <!-- ============ DIAGNOSTICS ============ -->
        <section class="doc-section" id="diagnostics">
            <h2>Route Diagnostics</h2>
            <p>Inspect registered routes and detect potential issues during development:</p>
            <pre><code class="language-php">use AsceticSoft\Waypoint\Diagnostic\RouteDiagnostics;

$diagnostics = new RouteDiagnostics($router->getRouteCollection());

// Print a formatted route table
$diagnostics->listRoutes();

// Detect conflicts
$report = $diagnostics->findConflicts();

if ($report->hasIssues()) {
    $diagnostics->printReport();
}</code></pre>

            <h3>Detected Issues</h3>
            <div class="diagnostics-grid">
                <div class="diagnostic-card">
                    <div class="diagnostic-icon warning">!</div>
                    <h4>Duplicate Paths</h4>
                    <p>Routes with identical patterns and overlapping HTTP methods.</p>
                </div>
                <div class="diagnostic-card">
                    <div class="diagnostic-icon error">!</div>
                    <h4>Duplicate Names</h4>
                    <p>Multiple routes sharing the same name.</p>
                </div>
                <div class="diagnostic-card">
                    <div class="diagnostic-icon info">!</div>
                    <h4>Shadowed Routes</h4>
                    <p>A more general pattern registered earlier hides a more specific one.</p>
                </div>
            </div>
        </section>

        <!-- ============ EXCEPTION HANDLING ============ -->
        <section class="doc-section" id="exception-handling">
            <h2>Exception Handling</h2>
            <p>Waypoint throws specific exceptions for routing failures:</p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Exception</th>
                            <th>HTTP Code</th>
                            <th>When</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><code>RouteNotFoundException</code></td><td>404</td><td>No route pattern matches the URI</td></tr>
                        <tr><td><code>MethodNotAllowedException</code></td><td>405</td><td>URI matches but HTTP method is not allowed</td></tr>
                        <tr><td><code>RouteNameNotFoundException</code></td><td>&mdash;</td><td>No route with the given name (URL generation)</td></tr>
                        <tr><td><code>MissingParametersException</code></td><td>&mdash;</td><td>Required route parameters not provided</td></tr>
                    </tbody>
                </table>
            </div>
            <pre><code class="language-php">use AsceticSoft\Waypoint\Exception\RouteNotFoundException;
use AsceticSoft\Waypoint\Exception\MethodNotAllowedException;

try {
    $response = $router->handle($request);
} catch (RouteNotFoundException $e) {
    // Return 404 response
} catch (MethodNotAllowedException $e) {
    // Return 405 response with Allow header
    $allowed = implode(', ', $e->getAllowedMethods());
}</code></pre>
        </section>

        <!-- ============ ARCHITECTURE ============ -->
        <section class="doc-section" id="architecture">
            <h2>Architecture</h2>
            <p>Waypoint is designed around a modular architecture where each component has a single responsibility:</p>
            <div class="architecture-diagram">
                <pre class="arch-tree"><code>Router  (PSR-15 RequestHandlerInterface)
‚îú‚îÄ‚îÄ RouteCollection
‚îÇ   ‚îú‚îÄ‚îÄ RouteTrie           ‚Äî prefix-tree for fast segment matching
‚îÇ   ‚îî‚îÄ‚îÄ Route[]             ‚Äî fallback linear matching for complex patterns
‚îú‚îÄ‚îÄ AttributeRouteLoader    ‚Äî reads #[Route] attributes via Reflection
‚îú‚îÄ‚îÄ MiddlewarePipeline      ‚Äî FIFO PSR-15 middleware execution
‚îú‚îÄ‚îÄ RouteHandler            ‚Äî invokes controller with DI
‚îú‚îÄ‚îÄ UrlGenerator            ‚Äî reverse routing (name + params ‚Üí URL)
‚îú‚îÄ‚îÄ RouteCompiler           ‚Äî compiles/loads route cache
‚îî‚îÄ‚îÄ RouteDiagnostics        ‚Äî conflict detection and reporting</code></pre>
            </div>
            <div class="callout callout-info">
                <strong>Performance Note</strong>
                <p>The <code>RouteTrie</code> handles the majority of routes with O(1) per-segment lookups. Routes with patterns that cannot be expressed in the trie (mixed static/parameter segments like <code>prefix-{name}.txt</code>, or cross-segment captures) automatically fall back to linear regex matching.</p>
            </div>
        </section>

        <!-- ============ API REFERENCE ============ -->
        <section class="doc-section" id="api-reference">
            <h2>API Reference</h2>

            <h3>Router</h3>
            <div class="api-method">
                <code class="method-sig">addRoute(string $path, array|Closure $handler, array $methods, array $middleware, string $name, int $priority): void</code>
                <p>Register a route for specific HTTP methods.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">get|post|put|delete|patch(string $path, array|Closure $handler, ...): void</code>
                <p>HTTP verb shortcut methods.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">group(string $prefix, Closure $callback, array $middleware): void</code>
                <p>Group routes under a shared prefix with optional middleware.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">addMiddleware(string|MiddlewareInterface $middleware): void</code>
                <p>Add global middleware.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">loadAttributes(string ...$classes): void</code>
                <p>Load routes from <code>#[Route]</code> attributes on given classes.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">scanDirectory(string $directory, string $namespace): void</code>
                <p>Auto-discover routes by scanning a directory.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">handle(ServerRequestInterface $request): ResponseInterface</code>
                <p>PSR-15 request handler. Match route and dispatch through middleware pipeline.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">generate(string $name, array $params, array $query): string</code>
                <p>Generate URL from a named route.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">compileTo(string $file): void</code>
                <p>Compile routes to a cache file.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">loadCache(string $file): void</code>
                <p>Load routes from a compiled cache file.</p>
            </div>

            <h3>RouteCollection</h3>
            <div class="api-method">
                <code class="method-sig">add(Route $route): void</code>
                <p>Add a route to the collection.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">match(string $method, string $uri): RouteMatchResult</code>
                <p>Match HTTP method and URI to a route.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">all(): Route[]</code>
                <p>Get all routes sorted by priority.</p>
            </div>
            <div class="api-method">
                <code class="method-sig">findByName(string $name): ?Route</code>
                <p>Find a route by its name.</p>
            </div>

            <h3>UrlGenerator</h3>
            <div class="api-method">
                <code class="method-sig">generate(string $name, array $params, array $query, bool $absolute): string</code>
                <p>Generate a URL from a route name with parameters.</p>
            </div>
        </section>

        <!-- ============ DEVELOPMENT ============ -->
        <section class="doc-section" id="development">
            <h2>Development</h2>
            <p>The project includes a <code>Makefile</code> with common development tasks:</p>
            <pre><code class="language-bash">make fix       # Auto-fix code style (PHP CS Fixer)
make cs-check  # Check code style (dry-run)
make stan      # Run PHPStan static analysis (level 9)
make test      # Run PHPUnit tests
make check     # Run all checks (cs-check + stan + test)
make all       # Fix code style, then run stan and tests</code></pre>
        </section>

        <!-- ============ FOOTER ============ -->
        <footer class="footer">
            <p>Waypoint is open-source software licensed under the <a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener">MIT License</a>.</p>
            <p class="footer-links">
                <a href="https://github.com/ascetic-soft/Waypoint" target="_blank" rel="noopener">GitHub</a>
                <span class="sep">&middot;</span>
                <a href="https://packagist.org/packages/ascetic-soft/waypoint" target="_blank" rel="noopener">Packagist</a>
                <span class="sep">&middot;</span>
                <a href="https://github.com/ascetic-soft/Waypoint/issues" target="_blank" rel="noopener">Issues</a>
            </p>
        </footer>
    </div>
</main>

<!-- ============ OVERLAY ============ -->
<div class="overlay" id="overlay"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
<script src="assets/script.js"></script>
</body>
</html>
